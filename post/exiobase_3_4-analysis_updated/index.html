<!doctype html><html dir=ltr lang=en data-theme><head><title>Kai Li | EIOA Class: Integrated Group Assignment(IGA)</title><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="Kai Li (李锴)
PhD candidate of Environmental Sciences
Leiden University"><link rel=stylesheet href=/css/style.min.8fbe65b29626c6d87aeeb947819fd916bf04fc4e4db0a65b5b2e888911de24be.css integrity="sha256-j75lspYmxth67rlHgZ/ZFr8E/E5NsKZbWy6IiRHeJL4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Kalam&family=Newsreader:wght@600&family=Oswald&family=Pattaya&family=Roboto&family=Rock+Salt&family=Ubuntu&display=swap" rel=stylesheet><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/post/exiobase_3_4-analysis_updated/><script type=text/javascript src=/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin=anonymous></script><script type=text/javascript src=/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://xiaoshan1994.github.io/images/site-feature-image.png"><meta name=twitter:title content="EIOA Class: Integrated Group Assignment(IGA)"><meta name=twitter:description content="Each group is expected to perform a research question about  two real-world issues: BREXIT and national stimulus plans
in a post COVID-19 world."></head><body><div class="sidebar animated fadeInDown"><div class=logo-title><div class=title><img src=/images/profile.png alt="profile picture"><h3 title><a href=/>Blog of Kai</a></h3><div class=description><p>Kai Li (李锴)<br>PhD candidate of Environmental Sciences<br>Leiden University</p></div></div></div><ul class=social-links><li><a href=https://www.universiteitleiden.nl/en/staffmembers/1/kai-li#tab-1 rel=me aria-label=university><i class="fas fa-university fa-2x" aria-hidden=true></i></a></li><li><a href="https://scholar.google.com/citations?user=JcZReB8AAAAJ&hl=zh-CN" rel=me aria-label=google><i class="fab fa-google fa-2x" aria-hidden=true></i></a></li><li><a href=https://github.com/xiaoshan1994 rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:k.li@cml.leidenuniv.nl rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Kai Li 2020-2021</div></div></div><div class=main><div class="page-top animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/post/ title>Posts</a></li><li><a href=/about/ title>About</a></li><li><a href=/contact/ title>Contact</a></li><li><a href=/ title=EN>EN</a></li><li><a href=/cn/ title=CN>CN</a></li><li class=theme-switch-item><a class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post animated fadeInDown"><div class=post-content><img class=post-thumbnail src=https://i.ytimg.com/vi/U0zOqSRzR-s/maxresdefault.jpg alt="Thumbnail image"><div class=post-title><h3>EIOA Class: Integrated Group Assignment(IGA)</h3><div class=info><em class="fas fa-calendar-day"></em><span class=date>17/5/2021</span>
<em class="fas fa-stopwatch"></em><span class=reading-time>5-minute read</span></div></div><p>Each group is expected to perform a research question about two real-world issues: BREXIT and national stimulus plans
in a post COVID-19 world.</p><h3 id=tasks>Tasks</h3><ol><li>Load from pickle</li><li>Calculate for a specific country territorial CO2 emissions</li><li>Calculate for a specific country consumption-based CO2 emissions</li><li>Identify top-5 sectors that contribute to territorial emissions of a specific country</li><li>Identify top-5 final demand expenditure on products that contribute to consumption-based emissions of a specific country</li><li>Identify top-5 countries where the specific country displaced its emissions to</li></ol><p>June 11 at 17:00 (deadline):Code and report(.pdf) in Brightspace/Assignments.
<link href="https://fonts.googleapis.com/css?family=Poppins" rel=stylesheet type=text/css><div style=font-family:poppins;font-size:30px;font-style:normal;font-weight:700>You are awesome.
You're even better!
What else ...</div></p><p>import numpy as np
import time
import pickle as pkl
import os
from pathlib import Path
np.set_printoptions(precision=2)</p><p>tstart = time.time()
##############################################
##############################################</p><h1 id=task-1-load-mrio-from-pickle>TASK 1: Load MRIO from Pickle</h1><p>##############################################</p><h1 id=folder-settings-change-the-current-working-directory-to-reflect-the-location-in-your-computer>Folder settings: Change the current working directory to reflect the location in your computer</h1><h1 id=run-osgetcwd-to-find-out-what-that-is>(run os.getcwd() to find out what that is)</h1><h1 id=folder-to-read-mrio-from>Folder to read MRIO from</h1><p>os.getcwd()
mrio_dir = Path("/&mldr;/EIOA/IGA/MRIO") # Fill " " with your working directory path</p><p>##############################################</p><h1 id=load-mrio>Load MRIO</h1><p>tstart = time.time()</p><p>mrio_name = &lsquo;mrio.pkl&rsquo;<br>mrio_str = mrio_dir.joinpath(mrio_name)<br>pkl_in = open(mrio_str,&ldquo;rb&rdquo;) # &lsquo;open&rsquo; the mrio.pkl file
mrio = pkl.load(pkl_in) # load the mrio.pkl file to mrio
pkl_in.close()</p><p>tend = time.time()
print(&lsquo;Done reading in %5.2f s\n&rsquo;% (tend - tstart))</p><h1 id=category-counts>category counts</h1><p>nr = mrio[&lsquo;label&rsquo;][&lsquo;region&rsquo;].count()[0]
ns = mrio[&lsquo;label&rsquo;][&lsquo;product&rsquo;].count()[0]
ny = mrio[&lsquo;label&rsquo;][&lsquo;final&rsquo;].count()[0]</p><h1 id=mrio-matrixvector-variables>MRIO matrix/vector variables</h1><p>L = mrio[&lsquo;L&rsquo;]
Y = mrio[&lsquo;Y&rsquo;]
V = mrio[&lsquo;V&rsquo;]
F = mrio[&lsquo;F&rsquo;]
F_co2 = mrio[&lsquo;F_co2&rsquo;]
H = mrio[&lsquo;H&rsquo;]
H_co2 = mrio[&lsquo;H_co2&rsquo;]</p><h1 id=calculate-total-output>calculate total output</h1><p>x = L @ Y.sum(1)</p><h1 id=calculate-direct-emissions-intensity>calculate direct emissions intensity</h1><p>f_co2 = F_co2/x # resulting in na or inf when x = 0
f_co2 = np.nan_to_num(f_co2, copy=False, nan=0.0, posinf=0.0, neginf=0.0) # replace na and inf with 0</p><p>##############################################
##############################################</p><h1 id=configuration-for-all-following-tasks>Configuration for all following tasks</h1><h1 id=change-to-choose-different-region-c-in-0-to-48>change to choose different region: c in 0 to 48</h1><h1 id=position-20-is-netherlands>position 20 is Netherlands</h1><h1 id=explore-mriolabelregion-to-find-others>explore mrio[&lsquo;label&rsquo;][&lsquo;region&rsquo;] to find others</h1><p>c = 20</p><h1 id=to-locate-country-columns-or-rows-in-a-and-l-cns--c1ns>To locate country columns or rows in A and L: &lsquo;c*ns : (c+1)*ns&rsquo;</h1><h1 id=to-locate-country-columns-in-y-cny--c1ny>To locate country columns in Y: &lsquo;c*ny : (c+1)*ny&rsquo;</h1><h1 id=convert-units-from-kg-to-mt-1e-9>convert units from kg to Mt (*1e-9)</h1><p>conv = 1e-9</p><p>##############################################
##############################################</p><h1 id=task-2-calculate-territorial-emissions-for-a-specific-country>TASK 2. Calculate territorial emissions for a specific country</h1><h1 id=we-want-to-report-three-cols-production-related-households-and-total-plus-a-global-contribution-percentage>We want to report three cols: production-related, households and total, plus a global contribution percentage</h1><p>pba = np.zeros((1,4))
pba[:,0] = F_co2[c*ns : (c+1)*ns].sum() <em>conv # direct emissions by producers<br>pba[:,1] = H_co2[c</em>ny : (c+1)*ny].sum() *conv # direct emissions by households
pba[:,2] = pba[:,0:2].sum()
pba[:,3] = pba[:,2]/((F_co2.sum()+H_co2.sum())*conv)*100</p><p>##############################################
##############################################</p><h1 id=task-3-calculate-for-a-specific-country-consumption-based-co2-emissions>TASK 3. Calculate for a specific country consumption-based CO2 emissions</h1><h1 id=we-want-to-report-three-cols-production-generated-households-and-total-plus-a-global-contribution-percentage>We want to report three cols: production-generated, households and total, plus a global contribution percentage</h1><p>cba = np.zeros((1,4))<br>y = Y[:, c*ny : (c+1)*ny].sum(1) # aggregate final demand to one column</p><p>cba[:,0] = f_co2 @ L @ y <em>conv # footprint traced to production emissions
cba[:,1] = H_co2[c</em>ny : (c+1)*ny].sum()*conv # footprint traced to household direct emissions
cba[:,2] = cba[:,:2].sum()
cba[:,3] = cba[:,2]/((F_co2.sum()+H_co2.sum())*conv)*100</p><p>##############################################
##############################################</p><h1 id=task-4-identify-top-5-sectors-that-contribute-to-production-based-emissions>TASK 4. Identify top-5 sectors that contribute to production-based emissions</h1><h1 id=pba_s-we-want-to-report-in-rows-each-sector-plus-household>pba_s: we want to report in rows each sector plus household</h1><p>label_s = list(mrio[&lsquo;label&rsquo;][&lsquo;product&rsquo;][&lsquo;Name&rsquo;]) + [&lsquo;Household direct&rsquo;]
pba_s = F_co2[c*ns : (c+1)*ns] *conv
pba_s = np.append(pba_s, pba[0,1]) # append household direct emissions to the end</p><h1 id=pba_s_sorted-we-want-to-report-in-rows-the-sorted-in-descending-order-sectoral-plus-household-results>pba_s_sorted: we want to report in rows the &lsquo;sorted&rsquo; (in descending order) sectoral plus household results;</h1><h1 id=3-cols-sectoral-emissions-percent-and-cumulative-percent>3 cols: sectoral emissions, percent, and cumulative percent</h1><p>pba_s_sorted = np.zeros((ns+1,3))
rank = np.argsort(pba_s) # returns indices that&rsquo;d sort the array low to high
rank = np.flip(rank) # flip so it goes &lsquo;high to low&rsquo;</p><p>pba_s_sorted[:,0] = np.sort(pba_s) # sort the values from &lsquo;low to high&rsquo;
pba_s_sorted[:,0] = np.flip(pba_s_sorted[:,0]) # flip so the values go from high to low
pba_s_sorted[:,1] = pba_s_sorted[:,0]/pba[0,2]*100 # percentage contribution
pba_s_sorted[:,2] = np.cumsum(pba_s_sorted[:,1]) # cumulative percentage contribution</p><h1 id=sector-names-of-the-top-5-emitters>sector names of the top 5 emitters</h1><p>for i in range(0,5) :<br>print(&ldquo;Top&rdquo;, i+1, label_s[rank[i]],"(sector index =", rank[i], &ldquo;);")</p><p>##############################################
##############################################</p><h1 id=task-5-identify-top-5-final-demand-spending-sectors-that-contribute-to-consumption-based-emissions>TASK 5. Identify top-5 final demand spending sectors that contribute to consumption-based emissions</h1><h1 id=task-6-identify-top-5-countries-where-the-specific-country-displaced-emissions-to>TASK 6. Identify top-5 countries where the specific country displaced emissions to</h1><p>label_s = list(mrio[&lsquo;label&rsquo;][&lsquo;product&rsquo;][&lsquo;Name&rsquo;]) + [&lsquo;Household direct&rsquo;]
cba_s = f_co2 @ L @ np.diag(y)*conv
cba_rs = np.reshape(cba_s,(nr,ns)) # pay attention to get the new shape dimension right
cba_s = cba_rs.sum(0) # by final demand sector
cba_s = np.append(cba_s,cba[0,1]) # append household direct emissions to the end
cba_r = cba_rs.sum(1) # by emitting regions
cba_r[c] = cba_r[c] + cba[0,1] # add HH direct emissions</p><h1 id=cba_s_sort-we-want-to-report-in-rows-each-final-demand-sectorproduct-plus-household>cba_s_sort: we want to report in rows each final demand sector(product) plus household</h1><h1 id=3-cols-sectoral-emissions-percent-and-cumulative-percent-1>3 cols: sectoral emissions, percent, and cumulative percent</h1><p>cba_s_sorted = np.zeros((ns+1,3))
rank = np.argsort(cba_s) # sort from &lsquo;low to high&rsquo; and returns indices
rank = np.flip(rank) # flip so it goes &lsquo;high to low&rsquo;</p><p>cba_s_sorted[:,0] = np.sort(cba_s) # sort the values from &lsquo;low to high&rsquo;
cba_s_sorted[:,0] = np.flip(cba_s_sorted[:,0]) # flip so the values go from high to low
cba_s_sorted[:,1] = cba_s_sorted[:,0]/cba[0,2]*100 # percentage contribution
cba_s_sorted[:,2] = np.cumsum(cba_s_sorted[:,1]) # cumulative percentage contribution</p><h1 id=sector-names-of-the-top-5-final-demand-product-categories>sector names of the top 5 final demand product categories</h1><p>for i in range(0,5) :<br>print(&ldquo;Top&rdquo;, i+1, label_s[rank[i]],"(sector index =&rdquo;, rank[i], &ldquo;);")</p><h1 id=cba_r_sort-we-want-to-report-in-rows-each-country-of-origin>cba_r_sort: we want to report in rows each country of origin</h1><h1 id=3-cols-country-emissions-percent-and-cumulative-percent>3 cols: country emissions, percent, and cumulative percent</h1><p>label_r = list(mrio[&lsquo;label&rsquo;][&lsquo;region&rsquo;][&lsquo;CountryName&rsquo;])
cba_r_sorted = np.zeros((nr,3))
rank = np.argsort(cba_r) # sort from &lsquo;low to high&rsquo; and returns indices
rank = np.flip(rank) # flip so it goes &lsquo;high to low&rsquo;</p><p>cba_r_sorted[:,0] = np.sort(cba_r) # sort the values from &lsquo;low to high&rsquo;
cba_r_sorted[:,0] = np.flip(cba_r_sorted[:,0]) # flip so the values go from high to low
cba_r_sorted[:,1] = cba_r_sorted[:,0]/cba[0,2]*100 # percentage contribution
cba_r_sorted[:,2] = np.cumsum(cba_r_sorted[:,1]) # cumulative percentage contribution</p><h1 id=country-names-of-the-top-5-displacement-locations>country names of the top 5 displacement locations</h1><p>if c in rank[0:5] :
for i in range(0,6) :<br>if rank[i] != c :<br>print(&ldquo;Top&rdquo;, i+1, label_r[rank[i]],"(country index =&rdquo;, rank[i], &ldquo;);")
else :
for i in range(0,5) :<br>print(&ldquo;Top&rdquo;, i+1, label_r[rank[i]],"(country index =&rdquo;, rank[i], &ldquo;);")</p></div><div class=post-footer><div class=info><span class=separator><a class=category href=/categories/eioa/>EIOA</a></span>
<span class=separator><a class=tag href=/tags/eioa-class/>EIOA Class</a><a class=tag href=/tags/python/>Python</a><a class=tag href=/tags/iga-work/>IGA work</a></span></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.2d6fd0be87fa98f0c9b4dc2536b312bbca48757f584f6ea1f394abc9bcc38fbc.js integrity="sha256-LW/Qvof6mPDJtNwlNrMSu8pIdX9YT26h85SrybzDj7w=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-123-45','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>